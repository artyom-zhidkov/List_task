<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>List Task Prototype</title>
</head>
<body>
    <button id="button_add_task">add task</button>
    <input id="input_content" type="text">
    <br>
    <div id="placeforlist">
    </div>
    <button id="button_remove_all">remove all</button>
    <button id="status_completed">hide completed</button>
    
    <script src="handlebars-v4.0.12.js"></script>
    
    <script id="list-template" type="text/x-handlebars-template">
        <ul id="unordered_list">
            {{#each tasks}}
                {{#if completed}}
                    <li style="text-decoration: line-through;">{{name}}</li>
                {{else}}
                    <li style="text-decoration: none;">{{name}}</li>
                {{/if}}
            {{/each}}
        </ul>
    </script>
       
    <script>
        var tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        var indicate_complite = JSON.parse(localStorage.getItem('indicate_complite')) || false;
        //false - зачеркнутые показаны //  true - прятаны
        const placeforlist = document.querySelector('#placeforlist');
        var source   = document.getElementById("list-template").innerHTML;
        var template = Handlebars.compile(source);

        function renderTasksAsHTML(tasks) {
            var randerTasks = tasks.filter(function(task) {
                if (indicate_complite && task.completed) {return false;} // если переключатель на спрятаны
                    else return true;
            });
            tasks = randerTasks;
            placeforlist.innerHTML = template({ tasks });
            listenTasksClick();
        }
        
        function handleTaskClick(e, taskIndex) {
            tasks[taskIndex].completed = !tasks[taskIndex].completed;
            writeToLocalStorageTasks();
            renderTasksAsHTML(tasks);
        }

        function listenTasksClick() {
            document
                .querySelectorAll('#unordered_list li')
                .forEach(function(element, index) {
                    element.addEventListener('click', function() {
                        handleTaskClick(element, index)
                    });
                }
            );
        }   
        
        function ToHideOrToShowCompletedTasks () {
            var value_content = document.querySelector('#status_completed');
            indicate_complite = indicate_complite ? false : true;
            var taskNoCompleted = tasks.every(function(task){
                return !task.completed;
            });
            if (indicate_complite && !taskNoCompleted) value_content.innerHTML = "show completed"
            else value_content.innerHTML = "hide completed";
            renderTasksAsHTML(tasks);
            localStorage.setItem('indicate_complite',JSON.stringify(indicate_complite));
        }
        
        function addListElement(e) {
            var input_content = document.getElementById('input_content').value;
 
            var task = {
                name: input_content,
                completed: false
            }

            if (input_content) {
                tasks.push(task);
                clearInput();         
                writeToLocalStorageTasks();
                renderTasksAsHTML(tasks);
            }
        }
        
        function removeAllElement(e) {
            tasks = [];
            renderTasksAsHTML(tasks);
            writeToLocalStorageTasks();
        }
        
        function pushButton(e) {
            if (event.keyCode == 13) addListElement();
        }
        
        function clearInput(e) {
            document.getElementById('input_content').value = '';
        }
        
        function writeToLocalStorageTasks() {
            localStorage.setItem('tasks',JSON.stringify(tasks));
        }

        document.getElementById('button_add_task').addEventListener('click',addListElement);
        document.getElementById('button_remove_all').addEventListener('click',removeAllElement);
        document.getElementById('status_completed').addEventListener('click',ToHideOrToShowCompletedTasks);
        document.getElementById('input_content').addEventListener('keyup',pushButton);

        renderTasksAsHTML(tasks);
    </script>
</body>
</html>
